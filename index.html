<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Foundry Cabinet Co. - Proposal Builder</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    @media print {
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      .print\\:hidden { display: none !important; }
      .proposal-page { width: 8.5in !important; height: 11in !important; margin: 0 !important; page-break-after: always !important; overflow: hidden !important; }
      @page { size: 8.5in 11in; margin: 0.25in; }
      .proposal-container, body { background: white !important; }
      body { font-size: 12px !important; }
    }
    .proposal-page { display: flex; flex-direction: column; min-height: 800px; box-sizing: border-box; }
    .timeline-item { display: flex !important; align-items: flex-start !important; margin-bottom: 1.5rem !important; page-break-inside: avoid !important; }
    .content-section { overflow-wrap: break-word; word-wrap: break-word; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { createClient } = supabase;
    const SUPABASE_URL = "https://nqzyoegnquyqfngmaktn.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const { useState, useEffect } = React;

    function ProposalBuilder() {
      const urlParams = new URLSearchParams(window.location.search);
      const isClientMode = urlParams.get("client") === "true";

      const [savedProposals, setSavedProposals] = useState([]);
      const [currentProposalName, setCurrentProposalName] = useState("");
      const [showLoadDialog, setShowLoadDialog] = useState(false);

      const [images, setImages] = useState({
        logo: null,
        shakerRender: null,
        euroRender: null,
        shakerVanity: null,
        euroVanity: null,
        floorPlan: null
      });

      const [content, setContent] = useState({
        title: "Custom Cabinet Proposal – Forest Grove, Oregon",
        projectNumber: "FCB-2025-001",
        date: new Date().toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" }),
        clientName: "Valued Client",
        executiveSummary: "We are pleased to present this proposal...",
        totalInvestment: "$7,595",
        warrantyYears: "3",
        warrantyText: "This includes build, delivery, and installation with a 3-year workmanship warranty.",
        shakerDescription: "Classic framed doors...",
        euroDescription: "Modern frameless full-overlay...",
        shakerVanityDescription: "Classic framed vanity...",
        euroVanityDescription: "Modern frameless vanity...",
        floorPlanDescription: "Plan view showing placement...",
        onlinePlansLink: "",
        sketchupLink: "",
        closingNote: "Thank you for considering Foundry Cabinet Co.",
        tagline: "Driven by Precision. Evolved by Design.",
        timeline: [
          { period: "WEEKS 1–2", task: "Design Development & Final Approval" },
          { period: "WEEKS 3–6", task: "Material Procurement & Shop Preparation" },
          { period: "WEEKS 7–12", task: "Custom Fabrication & Finishing" },
          { period: "WEEKS 13–14", task: "Professional Installation" },
          { period: "WEEK 15", task: "Final Walkthrough & Warranty Activation" }
        ],
        nextSteps: [
          "Select Shaker or Euro style",
          "Approve proposal & sign agreement",
          "Submit deposit to secure schedule"
        ]
      });

      // simplified save/load for brevity...
      const handleSaveClick = () => {
        const name = prompt("Enter a name for this proposal:");
        if (name && name.trim()) {
          setCurrentProposalName(name.trim());
          alert("Proposal saved (stub). Connect Supabase save here.");
        }
      };

      return (
        <div className="w-full bg-slate-100 min-h-screen">
          {!isClientMode && (
            <div className="bg-white shadow-lg border-b border-slate-200 print:hidden">
              <div className="max-w-7xl mx-auto p-8">
                <div className="flex items-center justify-between mb-8">
                  <div>
                    <h1 className="text-3xl font-light text-slate-800 tracking-tight">Professional Proposal Builder</h1>
                    {currentProposalName && (
                      <div className="text-sm text-slate-500 mt-1">
                        Current: <span className="font-medium">{currentProposalName}</span>
                        <span className="ml-2 text-green-600">● Auto-saving</span>
                      </div>
                    )}
                  </div>
                  <div className="flex space-x-3">
                    <button onClick={handleSaveClick} className="bg-green-600 text-white px-6 py-3">Save</button>
                    <button onClick={() => window.print()} className="bg-slate-800 text-white px-6 py-3">Generate PDF</button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Cover Page */}
          <div className="proposal-page w-full max-w-4xl mx-auto bg-white shadow-xl mb-8">
            <div className="bg-gradient-to-r from-slate-800 to-slate-700 p-8 relative">
              <div className="flex justify-between items-start">
                <div className="flex items-center space-x-6">
                  <img src={images.logo} alt="Company Logo" className="max-w-40 max-h-16 object-contain"/>
                  <div className="text-white">
                    <div className="text-2xl font-light tracking-wide">FOUNDRY</div>
                    <div className="text-lg font-light tracking-widest text-slate-300">CABINET · CO</div>
                    <div className="text-xs text-slate-400">by District Design Build, LLC</div>
                  </div>
                </div>
                <div className="text-right text-white text-sm">
                  <div className="font-medium tracking-wide">PROJECT {content.projectNumber}</div>
                  <div className="text-slate-300">{content.date}</div>
                </div>
              </div>
            </div>
            <div className="flex-1 flex flex-col justify-center items-center text-center px-16 py-12">
              <h1 className="text-4xl font-light text-slate-800">{content.title}</h1>
              <p className="mt-6 text-slate-600">{content.executiveSummary}</p>
            </div>
          </div>

          {/* Timeline / Next Steps / Closing */}
          <div className="proposal-page w-full max-w-4xl mx-auto bg-white shadow-xl mb-8">
            <div className="px-8 flex-1 flex flex-col">
              <div className="grid grid-cols-2 gap-12 mb-12">
                <div>
                  <h3 className="text-lg font-medium text-slate-800 border-b pb-3 mb-3">Project Timeline</h3>
                  <div className="space-y-3">
                    {content.timeline.map((item, idx) => (
                      <div key={idx} className="flex items-start space-x-3">
                        <div className="w-3 h-3 bg-slate-500 mt-1"></div>
                        <div>
                          <div className="font-bold text-slate-800 text-sm uppercase">{item.period}</div>
                          <div className="text-slate-600 text-base">{item.task}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                <div>
                  <h3 className="text-lg font-medium text-slate-800 border-b pb-3 mb-3">Next Steps</h3>
                  <ol className="list-decimal list-inside text-slate-700 space-y-2">
                    {content.nextSteps.map((step, idx) => (
                      <li key={idx}>{step}</li>
                    ))}
                  </ol>
                </div>
              </div>

              {/* Dark Footer */}
              <div className="bg-slate-800 text-center p-8 mt-auto">
                <img src={images.logo} alt="Company Logo" className="mx-auto max-h-16 mb-4 object-contain drop-shadow-lg"/>
                <div className="text-white text-base mb-2 tracking-wide">
                  {content.tagline}
                </div>
                <div className="text-slate-300 text-sm">
                  866 N Columbia Blvd, Suite B-110<br/>
                  Portland, OR 97217
                </div>
              </div>
            </div>
          </div>

        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<ProposalBuilder />);
  </script>
</body>
</html>
