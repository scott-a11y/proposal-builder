<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Foundry Cabinet ¬∑ Co ‚Äî Proposal Builder</title>

  <!-- Favicon -->
  <link rel="icon"
        href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><rect width="100%" height="100%" fill="%230b1120"/><text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-size="36" fill="white">F</text></svg>'/>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind + Supabase -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root { --header:#1e293b; --footer:#0b1120; }
    body { background:#f1f5f9; color:#111827; }
    .proposal-page { display:flex; flex-direction:column; min-height:800px; box-sizing:border-box; }
    .card { box-shadow: 0 6px 20px rgba(2,6,23,.08); }
    .logo-clean { display:block; max-height:160px; object-fit:contain; }
    @media print {
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      .print\:hidden { display: none !important; }
      .proposal-page { width: 8.5in !important; height: 11in !important; margin: 0 !important; page-break-after: always !important; overflow: hidden !important; }
      @page { size: 8.5in 11in; margin: 0.25in; }
      body { background:white !important; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { createClient } = supabase;

    // -------- CONFIG --------
    const DEFAULT_LOGO_PATH = "Foundry-Cabinetco-Logo-2-White-Text.png"; // place this file next to index.html
    const DEFAULT_LOGO_ALT_PATH = "./Foundry-Cabinetco-Logo-2-White-Text.png";

    const SUPABASE_URL = "https://nqzyoegnquyqfngmaktn.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xenlvZWducXV5cWZuZ21ha3RuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NTkzNzYsImV4cCI6MjA3NDQzNTM3Nn0.lcQ8VW3zSdvyoZkJbhnT3CeyeYbxswEiAhZnAjo5Lac";
    const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    // -------------------------

    const Label = ({children}) => <label className="text-xs font-medium text-slate-600 uppercase tracking-wide">{children}</label>;
    const Input = (props) => <input {...props} className={"w-full border rounded px-3 py-2 text-sm bg-white "+(props.className||"")} />;
    const TextArea = (props) => <textarea {...props} className={"w-full border rounded px-3 py-2 text-sm bg-white min-h-[84px] "+(props.className||"")} />;

    function App() {
      const urlParams = new URLSearchParams(window.location.search);
      const isClient = urlParams.get("client") === "true";

      const [savedProposals, setSavedProposals] = useState([]);
      const [currentName, setCurrentName] = useState("");

      const [images, setImages] = useState({
        logo: DEFAULT_LOGO_PATH,
        shakerRender: null, euroRender: null,
        shakerVanity: null, euroVanity: null, floorPlan: null
      });

      const [content, setContent] = useState({
        title: "Custom Cabinet Proposal ‚Äì Forest Grove, Oregon",
        projectNumber: "FCB-2025-001",
        date: new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' }),
        clientName: "Valued Client",
        executiveSummary: "We are pleased to present this proposal for custom cabinetry for your Forest Grove home. Two distinct style options: classic Shaker and modern Euro/Flat Panel.",
        totalInvestment: "$7,595",
        warrantyYears: "3",
        warrantyText: "Professional build, delivery, installation, backed by a 3-year workmanship warranty.",
        shakerDescription: "Classic framed doors with recessed panels. Painted finish.",
        euroDescription: "Modern frameless full-overlay doors. Natural finish or your chosen color.",
        shakerVanityDescription: "Classic framed vanity doors with recessed panels. Painted finish.",
        euroVanityDescription: "Modern frameless full-overlay vanity doors. Natural finish or your chosen color.",
        floorPlanDescription: "Plan view showing placement and dimensions.",
        closingNote: "Thank you for considering Foundry Cabinet Co. We look forward to creating cabinetry that's the perfect fit for your home.",
        tagline: "Driven by Precision. Evolved by Design.",
        address: "866 N Columbia Blvd, Suite B-110, Portland, OR 97217",
        timeline: [
          { period:"WEEKS 1‚Äì2", task:"Design Development & Final Approval" },
          { period:"WEEKS 3‚Äì6", task:"Material Procurement & Shop Preparation" },
          { period:"WEEKS 7‚Äì12", task:"Custom Fabrication & Finishing" },
          { period:"WEEKS 13‚Äì14", task:"Professional Installation" },
          { period:"WEEK 15", task:"Final Walkthrough & Warranty Activation" }
        ],
        nextSteps: ["Select Shaker or Euro style","Approve proposal & sign agreement","Submit deposit to secure schedule"],
        onlinePlansLink: "",
        sketchupLink: ""
      });

      // fetch proposals
      useEffect(() => { (async () => {
        const { data, error } = await db.from('proposals').select('*');
        if (!error && data) setSavedProposals(data.map(p => ({ name:p.name, savedAt:p.created_at, content:p.content, images:p.images })));
      })() }, []);

      // auto-save
      useEffect(() => {
        if (!currentName) return;
        const id = setInterval(() => save(currentName, false), 30000);
        return () => clearInterval(id);
      }, [content, images, currentName]);

      // uploads
      const onImgUpload = (key, file) => {
        const r = new FileReader();
        r.onload = e => setImages(prev => ({ ...prev, [key]: e.target.result }));
        r.readAsDataURL(file);
      };

      const setField = (k, v) => setContent(prev => ({ ...prev, [k]: v }));

      // save/load/delete
      const save = async (name, alertOK=true) => {
        try {
          const payload = { content, images };
          const { data:existing } = await db.from('proposals').select('name').eq('name', name).maybeSingle();
          if (existing) {
            const { error } = await db.from('proposals').update(payload).eq('name', name);
            if (error) throw error;
          } else {
            const { error } = await db.from('proposals').insert([{ name, ...payload }]);
            if (error) throw error;
          }
          setCurrentName(name);
          const { data } = await db.from('proposals').select('*');
          setSavedProposals(data.map(p => ({ name:p.name, savedAt:p.created_at, content:p.content, images:p.images })));
          if (alertOK) alert('Saved "' + name + '" to cloud.');
        } catch (e) { alert("Save failed: " + e.message); }
      };

      const loadOne = (name) => {
        const p = savedProposals.find(x => x.name === name);
        if (!p) return alert("Not found.");
        setContent(p.content);
        setImages(p.images || images);
        setCurrentName(name);
        alert('Loaded "' + name + '".');
      };

      const deleteOne = async (name) => {
        if (!confirm('Delete "'+name+'"?')) return;
        const { error } = await db.from('proposals').delete().eq('name', name);
        if (error) return alert("Delete failed: " + error.message);
        setSavedProposals(prev => prev.filter(p => p.name !== name));
        if (currentName === name) setCurrentName("");
        alert('Deleted "' + name + '".');
      };

      // -------- Export Client HTML (string concat; no nested backticks) --------
      const exportClientHTML = () => {
        const c = content; const img = images;
        function esc(s){ return (s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
        function has(v){ return v && (""+v).trim().length>0; }

        var inner = "<!DOCTYPE html><html lang='en'><head><meta charset='UTF-8'><meta name='viewport' content='width=device-width,initial-scale=1'>"
          + "<title>"+esc(c.title)+" - "+esc(c.clientName||"Client")+"</title>"
          + "<link rel='icon' href='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2264%22 height=%2264%22><rect width=%22100%%22 height=%22100%%22 fill=%230b1120/><text x=%2250%%22 y=%2255%%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2236%22 fill=%22white%22>F</text></svg>'/>"
          + "<script src='https://cdn.tailwindcss.com'><\\/script>"
          + "<style>@media print{*{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important}.proposal-page{width:8.5in!important;height:11in!important;margin:0!important;page-break-after:always!important;overflow:hidden!important}@page{size:8.5in 11in;margin:0.25in}}</style>"
          + "</head><body><div class='proposal-container max-w-none mx-auto bg-white'>";

        // PAGE 1
        inner += "<section class='proposal-page w-full max-w-4xl mx-auto bg-white shadow mb-8'>"
          + "<div class='px-8 pt-8 pb-3 flex justify-between items-start' style='background:#1e293b'>"
          +   "<img src='"+(img.logo || DEFAULT_LOGO_PATH)+"' alt='' style='max-height:160px;object-fit:contain' onerror='this.src=\""+DEFAULT_LOGO_ALT_PATH+"\";this.onerror=function(){this.style.display=\"none\";}'/>"
          +   "<div class='text-right text-white text-sm'><div class='font-medium tracking-wide'>PROJECT "+esc(c.projectNumber)+"</div><div class='text-slate-300'>"+esc(c.date)+"</div></div>"
          + "</div>"
          + "<div class='px-10 py-10 text-center'>"
          +   "<div class='text-sm font-medium text-slate-600 uppercase tracking-widest mb-4'>CUSTOM CABINETRY PROPOSAL</div>"
          +   "<h1 class='text-4xl font-light text-slate-800 mb-6'>"+esc(c.title)+"</h1>"
          +   "<div class='w-24 h-px bg-gradient-to-r from-transparent via-amber-400 to-transparent mx-auto mb-6'></div>"
          +   "<div class='bg-slate-50 p-8 border-l-4 border-slate-800 text-left card'>"
          +     "<div class='grid md:grid-cols-2 gap-8 mb-6'>"
          +       "<div class='text-center'><div class='text-3xl font-light text-slate-800 mb-2'>"+esc(c.totalInvestment)+"</div><div class='text-sm text-slate-600 uppercase tracking-wide'>Investment</div></div>"
          +       "<div class='text-center'><div class='text-3xl font-light text-slate-800 mb-2'>"+esc(c.warrantyYears)+"</div><div class='text-sm text-slate-600 uppercase tracking-wide'>Year Warranty</div></div>"
          +     "</div>"
          +     "<p class='text-base leading-relaxed text-slate-700 mb-4'>"+esc(c.executiveSummary)+"</p>"
          +     "<p class='text-sm text-slate-600'>"+esc(c.warrantyText)+"</p>"
          +   "</div>"
          + "</div>"
          + "<div class='text-white p-6 text-center' style='background:#0f172a'>"
          +   "<div class='w-64 h-px bg-white/20 mx-auto mb-3'></div>"
          +   "<div class='text-sm tracking-wide'>"+esc(c.tagline)+"</div>"
          +   "<div class='text-xs text-slate-300 mt-1'>"+esc(c.address)+"</div>"
          + "</div>"
          + "</section>";

        // PAGE 2
        function blockImageOr(src, label, h){ return src ? "<img src='"+src+"' class='w-full "+(h||"h-48")+" object-cover'/>" : "<div class='text-slate-400 text-sm'>"+label+"</div>"; }
        inner += "<section class='proposal-page w-full max-w-4xl mx-auto bg-white shadow mb-8'>"
          + "<div class='border-b border-slate-200 pb-6 mb-8 px-8 pt-8'><div class='flex justify-between items-center'><h2 class='text-2xl font-light text-slate-800 tracking-tight'>Design Options & Layout</h2><div class='text-sm text-slate-500'>PROJECT "+esc(c.projectNumber)+" | PAGE 02</div></div></div>"
          + "<div class='px-8 flex-1'>"
          +   "<div class='grid grid-cols-2 gap-10 mb-10'>"
          +     "<div class='space-y-4 text-center'>"
          +       "<h3 class='text-lg font-semibold text-slate-800 tracking-tight'>Shaker Style</h3>"
          +       "<div class='bg-slate-50 p-4 card h-48 flex items-center justify-center'>"+blockImageOr(img.shakerRender,"Shaker Kitchen","h-48")+"</div>"
          +       "<p class='text-sm text-slate-600'>"+esc(c.shakerDescription)+"</p>"
          +       "<div class='bg-slate-50 p-4 card h-40 flex items-center justify-center mt-4'>"+blockImageOr(img.shakerVanity,"Shaker Vanity","h-40")+"</div>"
          +       "<p class='text-sm text-slate-600'>"+esc(c.shakerVanityDescription)+"</p>"
          +     "</div>"
          +     "<div class='space-y-4 text-center'>"
          +       "<h3 class='text-lg font-semibold text-slate-800 tracking-tight'>Euro Style</h3>"
          +       "<div class='bg-slate-50 p-4 card h-48 flex items-center justify-center'>"+blockImageOr(img.euroRender,"Euro Kitchen","h-48")+"</div>"
          +       "<p class='text-sm text-slate-600'>"+esc(c.euroDescription)+"</p>"
          +       "<div class='bg-slate-50 p-4 card h-40 flex items-center justify-center mt-4'>"+blockImageOr(img.euroVanity,"Euro Vanity","h-40")+"</div>"
          +       "<p class='text-sm text-slate-600'>"+esc(c.euroVanityDescription)+"</p>"
          +     "</div>"
          +   "</div>"
          +   "<div class='space-y-3 text-center'>"
          +     "<h3 class='text-lg font-medium text-slate-800 tracking-tight'>Architectural Layout</h3>"
          +     "<div class='bg-slate-50 p-6 card'>"+blockImageOr(img.floorPlan,"Floor Plan","h-64 object-contain")+"</div>"
          +     "<p class='text-slate-600 text-sm'>"+esc(c.floorPlanDescription)+"</p>"
          +     (has(c.onlinePlansLink) ? "<div class='text-sm'><span class='text-slate-600'>View detailed plans:</span> <a class='text-slate-800 underline' target='_blank' rel='noreferrer' href='"+esc(c.onlinePlansLink)+"'>"+esc(c.onlinePlansLink)+"</a></div>" : "")
          +     (has(c.sketchupLink) ? "<div class='bg-amber-50 border border-amber-200 p-6 mt-4 text-center card'><h4 class='text-lg font-medium text-slate-800 mb-2'>üè† VIEW IN 3D</h4><p class='text-slate-600 text-sm mb-4'>Experience your kitchen design in full 3D. Rotate, zoom, and explore every detail.</p><a href='"+esc(c.sketchupLink)+"' target='_blank' rel='noreferrer' class='inline-block bg-slate-800 text-white px-6 py-2 rounded'>View 3D Model</a></div>" : "")
          +   "</div>"
          + "</div>"
          + "</section>";

        // PAGE 3 ‚Äî Timeline & unified footer (with spacing)
        function tlItem(colorClass, period, task){ return "<div class='flex items-start gap-3'><div class='w-4 h-4 "+colorClass+" mt-1'></div><div><div class='font-bold text-slate-800 text-sm uppercase'>"+esc(period)+"</div><div class='text-slate-600 mt-1'>"+esc(task)+"</div></div></div>"; }
        var tlHTML = ""; (c.timeline||[]).forEach(function(t,i){ var colors=["bg-amber-500","bg-slate-500","bg-slate-600","bg-slate-700","bg-slate-800"]; tlHTML += tlItem(colors[i%5], t.period, t.task); });
        function stepItem(i, text){ return "<div class='flex items-start gap-3'><div class='w-6 h-6 border-2 border-slate-800 flex items-center justify-center font-bold text-sm'>"+(i+1)+"</div><span class='text-slate-700'>"+esc(text)+"</span></div>"; }
        var stepsHTML=""; (c.nextSteps||[]).forEach(function(s,i){ stepsHTML+=stepItem(i,s); });

        inner += "<section class='proposal-page w-full max-w-4xl mx-auto bg-white shadow mb-8'>"
          + "<div class='border-b border-slate-200 pb-6 mb-8 px-8 pt-8'><div class='flex justify-between items-center'><h2 class='text-2xl font-light text-slate-800 tracking-tight'>Timeline & Next Steps</h2><div class='text-sm text-slate-500'>PROJECT "+esc(c.projectNumber)+" | PAGE 03</div></div></div>"
          + "<div class='px-8 flex-1 flex flex-col gap-16 mt-2'>"
          +   "<div><h3 class='text-lg font-medium text-slate-800 tracking-tight border-b border-slate-200 pb-3'>Project Timeline</h3><div class='mt-6 space-y-4'>"+tlHTML+"</div></div>"
          +   "<div><h3 class='text-lg font-medium text-slate-800 tracking-tight border-b border-slate-200 pb-3'>Next Steps</h3><div class='mt-6 space-y-3'>"+stepsHTML+"</div></div>"
          + "</div>"
          + "<div class='text-center p-12 mt-10' style='background:#0b1120'>"
          +   "<img src='"+(img.logo || DEFAULT_LOGO_PATH)+"' alt='' style='max-height:90px;object-fit:contain' onerror='this.src=\""+DEFAULT_LOGO_ALT_PATH+"\";this.onerror=function(){this.style.display=\"none\";}'/>"
          +   "<div class='text-white text-base mb-1 tracking-wide'>"+esc(c.tagline)+"</div>"
          +   "<div class='text-slate-300 text-sm'>"+esc(c.address)+"</div>"
          +   "<div class='text-slate-200 text-sm mt-4'>Thank you for considering Foundry Cabinet Co. We look forward to creating cabinetry that&#39;s the perfect fit for your home.</div>"
          + "</div>"
          + "</section>";

        inner += "</div></body></html>";

        const blob = new Blob([inner], {type:'text/html'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = (c.projectNumber || "proposal") + "_" + (c.clientName||"Client").replace(/\s+/g,'_') + "_Proposal.html";
        document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      };
      // ---------------------------------------------------------

      // UI
      return (
        <div className="w-full min-h-screen">
          {!isClient && (
            <header className="bg-white border-b print:hidden">
              <div className="max-w-7xl mx-auto p-4 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <img
                    src={images.logo || DEFAULT_LOGO_PATH}
                    alt=""
                    className="h-10"
                    onError={(e)=> {
                      const tried = e.currentTarget.getAttribute('data-tried') || '';
                      if (!tried) { e.currentTarget.src = DEFAULT_LOGO_ALT_PATH; e.currentTarget.setAttribute('data-tried','alt'); }
                      else { e.currentTarget.style.display = 'none'; }
                    }}
                  />
                  <div className="text-slate-800 font-medium">Full Proposal Builder ‚Äî Supabase</div>
                  {currentName && <div className="ml-3 text-xs text-green-600">‚óè Auto-saving</div>}
                </div>
                <div className="flex gap-2">
                  <button onClick={() => { const n=prompt('Name to save as:'); if(n) { setCurrentName(n.trim()); save(n.trim()); } }} className="bg-emerald-600 text-white px-4 py-2 rounded">Save</button>
                  <button onClick={async () => {
                    const { data, error } = await db.from('proposals').select('name, created_at').order('created_at', { ascending:false });
                    if (error) return alert("Load list failed: " + error.message);
                    const names = (data||[]).map(d => d.name);
                    const pick = prompt('Type the exact name to load:\n\n' + names.join('\n'));
                    if (pick) loadOne(pick.trim());
                  }} className="bg-sky-600 text-white px-4 py-2 rounded">Load</button>
                  <button onClick={exportClientHTML} className="bg-orange-600 text-white px-4 py-2 rounded">Export for Client</button>
                  <button onClick={() => window.open(window.location.href + '?client=true', '_blank')} className="bg-purple-600 text-white px-4 py-2 rounded">Client View</button>
                  <button onClick={() => window.print()} className="bg-slate-800 text-white px-4 py-2 rounded">Print / Save PDF</button>
                </div>
              </div>
            </header>
          )}

          {/* CLIENT MODE TOOLBAR (Export/PDF) */}
          {isClient && (
            <div className="bg-white shadow-sm border-b print:hidden">
              <div className="max-w-4xl mx-auto p-4 flex items-center justify-center gap-3">
                <button onClick={() => window.print()} className="bg-slate-800 text-white px-6 py-2 rounded">Download PDF</button>
                <button onClick={exportClientHTML} className="bg-orange-600 text-white px-6 py-2 rounded">Export HTML</button>
              </div>
            </div>
          )}

          {!isClient && (
            <div className="max-w-7xl mx-auto grid lg:grid-cols-3 gap-8 p-6 print:hidden">
              <div className="lg:col-span-2 bg-white p-4 rounded border card">
                <div className="grid md:grid-cols-2 gap-4">
                  <div><Label>Title</Label><Input value={content.title} onChange={e=>setField('title', e.target.value)} /></div>
                  <div><Label>Project #</Label><Input value={content.projectNumber} onChange={e=>setField('projectNumber', e.target.value)} /></div>
                  <div><Label>Date</Label><Input value={content.date} onChange={e=>setField('date', e.target.value)} /></div>
                  <div><Label>Client name</Label><Input value={content.clientName} onChange={e=>setField('clientName', e.target.value)} /></div>
                </div>
                <div className="grid md:grid-cols-2 gap-4 mt-4">
                  <div><Label>Total investment</Label><Input value={content.totalInvestment} onChange={e=>setField('totalInvestment', e.target.value)} /></div>
                  <div><Label>Warranty years</Label><Input value={content.warrantyYears} onChange={e=>setField('warrantyYears', e.target.value)} /></div>
                </div>
                <div className="mt-4"><Label>Executive summary</Label><TextArea value={content.executiveSummary} onChange={e=>setField('executiveSummary', e.target.value)} /></div>
                <div className="mt-4"><Label>Warranty text</Label><TextArea value={content.warrantyText} onChange={e=>setField('warrantyText', e.target.value)} /></div>
                <div className="grid md:grid-cols-2 gap-4 mt-4">
                  <div><Label>Shaker description</Label><TextArea value={content.shakerDescription} onChange={e=>setField('shakerDescription', e.target.value)} /></div>
                  <div><Label>Euro description</Label><TextArea value={content.euroDescription} onChange={e=>setField('euroDescription', e.target.value)} /></div>
                </div>
                <div className="grid md:grid-cols-2 gap-4 mt-4">
                  <div><Label>Shaker Vanity description</Label><TextArea value={content.shakerVanityDescription} onChange={e=>setField('shakerVanityDescription', e.target.value)} /></div>
                  <div><Label>Euro Vanity description</Label><TextArea value={content.euroVanityDescription} onChange={e=>setField('euroVanityDescription', e.target.value)} /></div>
                </div>
                <div className="mt-4"><Label>Floor plan description</Label><TextArea value={content.floorPlanDescription} onChange={e=>setField('floorPlanDescription', e.target.value)} /></div>
                <div className="grid md:grid-cols-2 gap-4 mt-4">
                  <div><Label>Online plans link</Label><Input value={content.onlinePlansLink} onChange={e=>setField('onlinePlansLink', e.target.value)} placeholder="https://‚Ä¶" /></div>
                  <div><Label>SketchUp 3D link</Label><Input value={content.sketchupLink} onChange={e=>setField('sketchupLink', e.target.value)} placeholder="https://‚Ä¶" /></div>
                </div>
                <div className="grid md:grid-cols-2 gap-4 mt-4">
                  <div><Label>Tagline</Label><Input value={content.tagline} onChange={e=>setField('tagline', e.target.value)} /></div>
                  <div><Label>Footer address</Label><Input value={content.address} onChange={e=>setField('address', e.target.value)} /></div>
                </div>
              </div>

              <div className="bg-white p-5 rounded border card space-y-6">
                <div className="font-semibold text-slate-700">Visual Assets</div>
                <div className="space-y-3">
                  {[["logo","Company Logo"],["shakerRender","Shaker Kitchen"],["euroRender","Euro Kitchen"],["shakerVanity","Shaker Vanity"],["euroVanity","Euro Vanity"],["floorPlan","Floor Plan"]].map(([k,label]) => (
                    <div key={k} className="flex items-center justify-between gap-2">
                      <span className="text-sm text-slate-700">{label}</span>
                      <input type="file" accept="image/*" onChange={e=> e.target.files[0] && onImgUpload(k, e.target.files[0])} className="text-sm"/>
                    </div>
                  ))}
                </div>

                <div>
                  <div className="font-semibold text-slate-700 mb-2">Timeline</div>
                  content.timeline.map
                  <button className="bg-slate-700 text-white text-xs rounded px-3 py-1" onClick={()=>setContent(prev=>({ ...prev, timeline:[...prev.timeline, {period:"NEW PERIOD", task:"New Task"}] }))}>+ Add</button>
                </div>

                <div>
                  <div className="font-semibold text-slate-700 mb-2">Next Steps</div>
                  {content.nextSteps.map((s,i)=>(
                    <div key={i} className="flex items-center gap-2 mb-2">
                      <Input value={s} onChange={e=>setContent(prev=>({ ...prev, nextSteps: prev.nextSteps.map((x,idx)=> idx===i? e.target.value : x) }))} />
                      <button className="bg-red-500 text-white text-xs rounded px-2 py-2 sm:py-0 sm:h-[38px]" onClick={()=>setContent(prev=>({ ...prev, nextSteps: prev.nextSteps.filter((_,idx)=>idx!==i) }))}>Remove</button>
                    </div>
                  ))}
                  <button className="bg-slate-700 text-white text-xs rounded px-3 py-1" onClick={()=>setContent(prev=>({ ...prev, nextSteps:[...prev.nextSteps, "New step"] }))}>+ Add</button>
                </div>
              </div>
            </div>
          )}

          {/* Preview Pages */}
          <div className="proposal-container max-w-none mx-auto bg-white">
            {/* PAGE 1 (header has logo) */}
            <section className="proposal-page w-full max-w-4xl mx-auto bg-white shadow mb-8">
              <div className="px-8 pt-8 pb-3 flex justify-between items-start" style={{background:"var(--header)"}}>
                <img
                  src={images.logo || DEFAULT_LOGO_PATH}
                  alt=""
                  className="logo-clean"
                  onError={(e)=> {
                    const tried = e.currentTarget.getAttribute('data-tried') || '';
                    if (!tried) { e.currentTarget.src = DEFAULT_LOGO_ALT_PATH; e.currentTarget.setAttribute('data-tried','alt'); }
                    else { e.currentTarget.style.display = 'none'; }
                  }}
                />
                <div className="text-right text-white text-sm">
                  <div className="font-medium tracking-wide">PROJECT {content.projectNumber}</div>
                  <div className="text-slate-300">{content.date}</div>
                </div>
              </div>
              <div className="px-10 py-10 text-center">
                <div className="text-sm font-medium text-slate-600 uppercase tracking-widest mb-4">CUSTOM CABINETRY PROPOSAL</div>
                <h1 className="text-4xl font-light text-slate-800 mb-6">{content.title}</h1>
                <div className="w-24 h-px bg-gradient-to-r from-transparent via-amber-400 to-transparent mx-auto mb-6"></div>
                <div className="bg-slate-50 p-8 border-l-4 border-slate-800 text-left card">
                  <div className="grid md:grid-cols-2 gap-8 mb-6">
                    <div className="text-center">
                      <div className="text-3xl font-light text-slate-800 mb-2">{content.totalInvestment}</div>
                      <div className="text-sm text-slate-600 uppercase tracking-wide">Investment</div>
                    </div>
                    <div className="text-center">
                      <div className="text-3xl font-light text-slate-800 mb-2">{content.warrantyYears}</div>
                      <div className="text-sm text-slate-600 uppercase tracking-wide">Year Warranty</div>
                    </div>
                  </div>
                  <p className="text-base leading-relaxed text-slate-700 mb-4">{content.executiveSummary}</p>
                  <p className="text-sm text-slate-600">{content.warrantyText}</p>
                </div>
              </div>
              <div className="text-white p-6 text-center" style={{background:"#0f172a"}}>
                <div className="w-64 h-px bg-white/20 mx-auto mb-3"></div>
                <div className="text-sm tracking-wide">{content.tagline}</div>
                <div className="text-xs text-slate-300 mt-1">{content.address}</div>
              </div>
            </section>

            {/* PAGE 2 (NO logo) */}
            <section className="proposal-page w-full max-w-4xl mx-auto bg-white shadow mb-8">
              <div className="border-b border-slate-200 pb-6 mb-8 px-8 pt-8">
                <div className="flex justify-between items-center">
                  <h2 className="text-2xl font-light text-slate-800 tracking-tight">Design Options & Layout</h2>
                  <div className="text-sm text-slate-500">PROJECT {content.projectNumber} | PAGE 02</div>
                </div>
              </div>
              <div className="px-8 flex-1">
                <div className="grid md:grid-cols-2 gap-10 mb-10">
                  <div className="space-y-4 text-center">
                    <h3 className="text-lg font-semibold text-slate-800 tracking-tight">Shaker Style</h3>
                    <div className="bg-slate-50 p-4 card h-48 flex items-center justify-center">{images.shakerRender ? <img src={images.shakerRender} className="w-full h-full object-cover"/> : <div className="text-slate-400 text-sm">Shaker Kitchen</div>}</div>
                    <p className="text-sm text-slate-600">{content.shakerDescription}</p>
                    <div className="bg-slate-50 p-4 card h-40 flex items-center justify-center mt-4">{images.shakerVanity ? <img src={images.shakerVanity} className="w-full h-full object-cover"/> : <div className="text-slate-400 text-sm">Shaker Vanity</div>}</div>
                    <p className="text-sm text-slate-600">{content.shakerVanityDescription}</p>
                  </div>
                  <div className="space-y-4 text-center">
                    <h3 className="text-lg font-semibold text-slate-800 tracking-tight">Euro Style</h3>
                    <div className="bg-slate-50 p-4 card h-48 flex items-center justify-center">{images.euroRender ? <img src={images.euroRender} className="w-full h-full object-cover"/> : <div className="text-slate-400 text-sm">Euro Kitchen</div>}</div>
                    <p className="text-sm text-slate-600">{content.euroDescription}</p>
                    <div className="bg-slate-50 p-4 card h-40 flex items-center justify-center mt-4">{images.euroVanity ? <img src={images.euroVanity} className="w-full h-full object-cover"/> : <div className="text-slate-400 text-sm">Euro Vanity</div>}</div>
                    <p className="text-sm text-slate-600">{content.euroVanityDescription}</p>
                  </div>
                </div>

                <div className="space-y-3 text-center">
                  <h3 className="text-lg font-medium text-slate-800 tracking-tight">Architectural Layout</h3>
                  <div className="bg-slate-50 p-6 card">{images.floorPlan ? <img src={images.floorPlan} className="w-full h-64 object-contain"/> : <div className="text-slate-40 0 text-sm h-64 flex items-center justify-center">Floor Plan</div>}</div>
                  <p className="text-slate-600 text-sm">{content.floorPlanDescription}</p>
                  {content.onlinePlansLink ? <div className="text-sm"><span className="text-slate-600">View detailed plans:</span> <a className="text-slate-800 underline" target="_blank" rel="noreferrer" href={content.onlinePlansLink}>{content.onlinePlansLink}</a></div> : null}
                  {content.sketchupLink ? <div className="bg-amber-50 border border-amber-200 p-6 mt-4 text-center card"><h4 className="text-lg font-medium text-slate-800 mb-2">üè† VIEW IN 3D</h4><p className="text-slate-600 text-sm mb-4">Experience your kitchen design in full 3D. Rotate, zoom, and explore every detail.</p><a href={content.sketchupLink} target="_blank" rel="noreferrer" className="inline-block bg-slate-800 text-white px-6 py-2 rounded">View 3D Model</a></div> : null}
                </div>
              </div>
            </section>

            {/* PAGE 3 ‚Äî Timeline & unified footer */}
            <section className="proposal-page w-full max-w-4xl mx-auto bg-white shadow mb-8">
              <div className="border-b border-slate-200 pb-6 mb-8 px-8 pt-8">
                <div className="flex justify-between items-center">
                  <h2 className="text-2xl font-light text-slate-800 tracking-tight">Timeline & Next Steps</h2>
                  <div className="text-sm text-slate-500">PROJECT {content.projectNumber} | PAGE 03</div>
                </div>
              </div>

              <div className="px-8 flex-1 flex flex-col gap-16 mt-2">
                <div>
                  <h3 className="text-lg font-medium text-slate-800 tracking-tight border-b border-slate-200 pb-3">Project Timeline</h3>
                  <div className="mt-6 space-y-4">
                    {content.timeline.map((t,i)=> (
                      <div key={i} className="flex items-start gap-3">
                        <div className={["bg-amber-500","bg-slate-500","bg-slate-600","bg-slate-700","bg-slate-800"][i%5] + " w-4 h-4 mt-1"}></div>
                        <div>
                          <div className="font-bold text-slate-800 text-sm uppercase">{t.period}</div>
                          <div className="text-slate-600 mt-1">{t.task}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                <div>
                  <h3 className="text-lg font-medium text-slate-800 tracking-tight border-b border-slate-200 pb-3">Next Steps</h3>
                  <div className="mt-6 space-y-3">
                    {content.nextSteps.map((s,i)=> (
                      <div key={i} className="flex items-start gap-3">
                        <div className="w-6 h-6 border-2 border-slate-800 flex items-center justify-center font-bold text-sm">{i+1}</div>
                        <span className="text-slate-700">{s}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Unified footer: logo + tagline + address + thank-you */}
              <div className="text-center p-12 mt-10" style={{background:"var(--footer)"}}>
                <img
                  src={images.logo || DEFAULT_LOGO_PATH}
                  alt=""
                  className="mx-auto mb-4"
                  style={{maxHeight:"90px", objectFit:"contain"}}
                  onError={(e)=> {
                    const tried = e.currentTarget.getAttribute('data-tried') || '';
                    if (!tried) { e.currentTarget.src = DEFAULT_LOGO_ALT_PATH; e.currentTarget.setAttribute('data-tried','alt'); }
                    else { e.currentTarget.style.display = 'none'; }
                  }}
                />
                <div className="text-white text-base mb-1 tracking-wide">{content.tagline}</div>
                <div className="text-slate-300 text-sm">{content.address}</div>
                <div className="text-slate-200 text-sm mt-4">
                  Thank you for considering Foundry Cabinet Co. We look forward to creating cabinetry that's the perfect fit for your home.
                </div>
              </div>
            </section>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>

